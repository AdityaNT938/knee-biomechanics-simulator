<!DOCTYPE html>
<html>
<head>
    <title>Human Leg Biomechanics Simulator</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a, #1e293b);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
        }
        .visualization {
            flex: 1;
            min-width: 600px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid #475569;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .controls {
            flex: 1;
            min-width: 400px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid #475569;
        }
        h1 {
            text-align: center;
            color: #60a5fa;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #94a3b8;
            margin-bottom: 40px;
        }
        .leg-container {
            width: 100%;
            height: 500px;
            position: relative;
            margin: 20px 0;
        }
        .leg-svg {
            width: 100%;
            height: 100%;
        }
        .slider-group {
            margin: 30px 0;
        }
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
            color: #cbd5e1;
        }
        .slider-value {
            color: #60a5fa;
            font-weight: bold;
            background: rgba(96, 165, 250, 0.1);
            padding: 3px 12px;
            border-radius: 15px;
        }
        input[type="range"] {
            width: 100%;
            height: 12px;
            -webkit-appearance: none;
            background: linear-gradient(to right, #1e40af, #3b82f6, #60a5fa);
            border-radius: 10px;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            border: 3px solid #3b82f6;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.8);
        }
        .risk-panel {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
            border-left: 5px solid;
            transition: all 0.3s;
        }
        .risk-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        .metric {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        .metric-label {
            color: #94a3b8;
            font-size: 0.9rem;
        }
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 25px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        .analysis {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            margin-top: 25px;
            line-height: 1.6;
        }
        .highlight {
            color: #60a5fa;
            font-weight: bold;
        }
        .danger { color: #f87171; }
        .warning { color: #fbbf24; }
        .safe { color: #4ade80; }
    </style>
</head>
<body>
    <h1>ü¶µ Human Leg Biomechanics Simulator</h1>
    <p class="subtitle">Visualize how knee movements affect injury risk in football players</p>
    
    <div class="container">
        <!-- Visualization Panel -->
        <div class="visualization">
            <h2 style="color: #38bdf8; margin-bottom: 20px;">Leg Anatomy Visualization</h2>
            <div class="leg-container">
                <svg class="leg-svg" viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
                    <!-- Background grid -->
                    <defs>
                        <pattern id="grid" width="50" height="50" patternUnits="userSpaceOnUse">
                            <path d="M 50 0 L 0 0 0 50" fill="none" stroke="#334155" stroke-width="1"/>
                        </pattern>
                        <!-- Gradient for muscles -->
                        <linearGradient id="muscleGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#f97316;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#ea580c;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="boneGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#fef3c7;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#fde68a;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    
                    <rect width="100%" height="100%" fill="url(#grid)" opacity="0.2"/>
                    
                    <!-- Upper Leg (Thigh) -->
                    <g id="thigh-group">
                        <!-- Quadriceps Muscle -->
                        <path id="quadriceps" d="M 350,100 C 320,150 330,250 350,300 L 450,300 C 470,250 480,150 450,100 Z" 
                              fill="url(#muscleGrad)" stroke="#c2410c" stroke-width="2" opacity="0.9"/>
                        
                        <!-- Femur Bone -->
                        <rect id="femur" x="390" y="100" width="20" height="200" rx="10" 
                              fill="url(#boneGrad)" stroke="#d97706" stroke-width="3"/>
                        
                        <!-- Hamstrings Muscle (back) -->
                        <path id="hamstrings" d="M 350,110 C 330,180 340,280 350,350 L 450,350 C 460,280 470,180 450,110 Z" 
                              fill="#7c2d12" fill-opacity="0.7" stroke="#9a3412" stroke-width="2"/>
                    </g>
                    
                    <!-- Knee Joint -->
                    <g id="knee-group">
                        <!-- Femoral Condyles -->
                        <ellipse id="femoral-condyles" cx="400" cy="300" rx="40" ry="25" 
                                 fill="#fbbf24" stroke="#f59e0b" stroke-width="3"/>
                        
                        <!-- Patella (Knee Cap) -->
                        <circle id="patella" cx="440" cy="280" r="20" fill="#ef4444" stroke="#dc2626" stroke-width="3"/>
                        
                        <!-- ACL Ligament -->
                        <line id="acl" x1="380" y1="270" x2="420" y2="330" 
                              stroke="#ef4444" stroke-width="8" stroke-linecap="round"/>
                        
                        <!-- PCL Ligament -->
                        <line id="pcl" x1="420" y1="270" x2="380" y2="330" 
                              stroke="#3b82f6" stroke-width="8" stroke-linecap="round"/>
                        
                        <!-- MCL Ligament -->
                        <line id="mcl" x1="360" y1="300" x2="360" y2="340" 
                              stroke="#f59e0b" stroke-width="6" stroke-linecap="round"/>
                    </g>
                    
                    <!-- Lower Leg (Shin) -->
                    <g id="shin-group">
                        <!-- Tibia Bone -->
                        <rect id="tibia" x="390" y="325" width="20" height="200" rx="10" 
                              fill="#e0f2fe" stroke="#38bdf8" stroke-width="3"/>
                        
                        <!-- Fibula Bone (smaller, lateral) -->
                        <rect id="fibula" x="430" y="330" width="10" height="190" rx="5" 
                              fill="#bae6fd" stroke="#0ea5e9" stroke-width="2"/>
                        
                        <!-- Calf Muscles -->
                        <ellipse id="calf" cx="400" cy="450" rx="60" ry="40" 
                                 fill="#0c4a6e" fill-opacity="0.7" stroke="#0369a1" stroke-width="2"/>
                        
                        <!-- Tibial Plateau -->
                        <rect id="tibial-plateau" x="370" y="325" width="60" height="10" rx="5" 
                              fill="#7dd3fc" stroke="#0ea5e9" stroke-width="2"/>
                    </g>
                    
                    <!-- Ankle Joint -->
                    <g id="ankle-group">
                        <circle cx="400" cy="525" r="25" fill="#94a3b8" stroke="#64748b" stroke-width="3"/>
                    </g>
                    
                    <!-- Labels -->
                    <g font-family="Arial" font-size="14" fill="white" text-anchor="middle">
                        <text x="400" y="80">Femur (Thigh Bone)</text>
                        <text x="440" y="270">Patella</text>
                        <text x="350" y="260">ACL</text>
                        <text x="450" y="260">PCL</text>
                        <text x="340" y="320">MCL</text>
                        <text x="400" y="380">Tibia</text>
                        <text x="440" y="400">Fibula</text>
                        <text x="400" y="550">Ankle</text>
                        <text x="400" y="200">Quadriceps</text>
                        <text x="400" y="490">Calf Muscle</text>
                    </g>
                    
                    <!-- Force Vectors -->
                    <g id="force-vectors" opacity="0">
                        <line x1="400" y1="300" x2="400" y2="250" stroke="#10b981" stroke-width="4" stroke-dasharray="5,5"/>
                        <text x="400" y="240" fill="#10b981" text-anchor="middle">Ground Force</text>
                    </g>
                </svg>
            </div>
        </div>
        
        <!-- Controls Panel -->
        <div class="controls">
            <h2 style="color: #38bdf8; margin-bottom: 30px;">Biomechanical Controls</h2>
            
            <!-- Flexion Slider -->
            <div class="slider-group">
                <div class="slider-label">
                    <span>Knee Flexion Angle</span>
                    <span class="slider-value" id="flexion-value">0¬∞</span>
                </div>
                <input type="range" min="0" max="140" value="0" id="flexion-slider">
                <div style="display: flex; justify-content: space-between; margin-top: 5px; color: #94a3b8;">
                    <span>Straight</span>
                    <span>Fully Bent</span>
                </div>
            </div>
            
            <!-- Valgus Slider -->
            <div class="slider-group">
                <div class="slider-label">
                    <span>Knee Valgus (Inward Collapse)</span>
                    <span class="slider-value" id="valgus-value">0¬∞</span>
                </div>
                <input type="range" min="-10" max="25" value="0" id="valgus-slider">
                <div style="display: flex; justify-content: space-between; margin-top: 5px; color: #94a3b8;">
                    <span>Varus (Outward)</span>
                    <span>Valgus (Inward)</span>
                </div>
            </div>
            
            <!-- Risk Panel -->
            <div class="risk-panel" id="risk-panel">
                <div class="risk-title">
                    ‚ö†Ô∏è <span id="risk-title-text">INJURY RISK ASSESSMENT</span>
                </div>
                <div class="metrics">
                    <div class="metric">
                        <div class="metric-label">ACL Load</div>
                        <div class="metric-value" id="acl-load">1200</div>
                        <div class="metric-label">Newtons</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Risk Level</div>
                        <div class="metric-value" id="risk-level">LOW</div>
                        <div class="metric-label" id="risk-color">SAFE</div>
                    </div>
                </div>
            </div>
            
            <!-- Legend -->
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #ef4444;"></div>
                    <span>ACL (Anterior Cruciate Ligament)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #3b82f6;"></div>
                    <span>PCL (Posterior Cruciate Ligament)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f59e0b;"></div>
                    <span>MCL (Medial Collateral Ligament)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f97316;"></div>
                    <span>Muscle Tissue</span>
                </div>
            </div>
            
            <!-- Analysis -->
            <div class="analysis">
                <h3 style="margin-bottom: 15px; color: #38bdf8;">üìä Biomechanical Analysis</h3>
                <p id="analysis-text">In neutral position, all ligaments are within safe loading limits. This is optimal for athletic performance.</p>
                <p style="margin-top: 15px;">
                    <span class="highlight">‚ö†Ô∏è Football Risk Position:</span> 
                    <span id="football-risk">Valgus > 10¬∞ + Rotation during cutting</span>
                </p>
            </div>
        </div>
    </div>

    <script>
        // Get DOM elements
        const flexionSlider = document.getElementById('flexion-slider');
        const valgusSlider = document.getElementById('valgus-slider');
        const flexionValue = document.getElementById('flexion-value');
        const valgusValue = document.getElementById('valgus-value');
        const aclLoad = document.getElementById('acl-load');
        const riskLevel = document.getElementById('risk-level');
        const riskColor = document.getElementById('risk-color');
        const riskPanel = document.getElementById('risk-panel');
        const analysisText = document.getElementById('analysis-text');
        const footballRisk = document.getElementById('football-risk');
        const riskTitleText = document.getElementById('risk-title-text');
        
        // Get SVG elements
        const thighGroup = document.getElementById('thigh-group');
        const shinGroup = document.getElementById('shin-group');
        const kneeGroup = document.getElementById('knee-group');
        const patella = document.getElementById('patella');
        const acl = document.getElementById('acl');
        const mcl = document.getElementById('mcl');
        const forceVectors = document.getElementById('force-vectors');
        const femur = document.getElementById('femur');
        const tibia = document.getElementById('tibia');
        
        // Initial positions for animation
        const initialPatella = { cx: 440, cy: 280 };
        const initialACL = { x1: 380, y1: 270, x2: 420, y2: 330 };
        const initialMCL = { x1: 360, y1: 300, x2: 360, y2: 340 };
        
        // Biomechanical calculations
        function calculateInjuryMetrics(flexion, valgus) {
            let aclLoad = 1200; // Base load in Newtons
            
            // Flexion effect
            if (flexion > 30) aclLoad += (flexion - 30) * 10;
            
            // Valgus effect (most dangerous)
            if (valgus > 0) {
                aclLoad += valgus * valgus * 15;
            }
            
            // Combined effect
            if (valgus > 10 && flexion > 60) {
                aclLoad *= 1.5; // Football cutting injury
            }
            
            return {
                acl: Math.round(aclLoad),
                mcl: Math.round(800 + Math.max(0, valgus) * 20),
                overallRisk: aclLoad
            };
        }
        
        function getRiskInfo(metrics) {
            const load = metrics.acl;
            
            if (load < 1800) {
                return {
                    level: "LOW",
                    color: "#4ade80",
                    title: "Safe Movement",
                    borderColor: "#4ade80"
                };
            } else if (load < 2800) {
                return {
                    level: "MODERATE",
                    color: "#fbbf24",
                    title: "Caution Needed",
                    borderColor: "#fbbf24"
                };
            } else if (load < 4000) {
                return {
                    level: "HIGH",
                    color: "#f97316",
                    title: "High Injury Risk",
                    borderColor: "#f97316"
                };
            } else {
                return {
                    level: "EXTREME",
                    color: "#ef4444",
                    title: "‚ö†Ô∏è IMMEDIATE RISK",
                    borderColor: "#ef4444"
                };
            }
        }
        
        function getAnalysis(flexion, valgus, metrics) {
            const risk = getRiskInfo(metrics);
            
            if (valgus > 15) {
                return "üö® <span class='danger'>DANGEROUS:</span> Severe valgus collapse. This is the primary mechanism for non-contact ACL tears in football during cutting movements.";
            } else if (valgus > 10) {
                return "‚ö†Ô∏è <span class='warning'>WARNING:</span> Significant valgus stress. Weak hip abductors and poor landing mechanics increase ACL strain by up to 300%.";
            } else if (flexion < 20 && valgus > 5) {
                return "‚ö†Ô∏è <span class='warning'>WARNING:</span> Near-extension with valgus stresses both ACL and PCL. Common in awkward landings after jumps.";
            } else if (metrics.acl > 2500) {
                return "‚ö†Ô∏è <span class='warning'>MODERATE RISK:</span> Combined factors increasing ACL load. Focus on neuromuscular training and proper technique.";
            } else {
                return "‚úÖ <span class='safe'>SAFE:</span> Knee alignment within optimal range. Maintain proper form during sports activities.";
            }
        }
        
        function getFootballRiskText(valgus) {
            if (valgus > 12) {
                return "<span class='danger'>Extreme ACL tear risk during cutting/tackling</span>";
            } else if (valgus > 8) {
                return "<span class='warning'>High risk during sudden direction changes</span>";
            } else if (valgus > 5) {
                return "<span class='warning'>Moderate risk - improve hip strength</span>";
            } else {
                return "<span class='safe'>Low risk - maintain current form</span>";
            }
        }
        
        // Update model function
        function updateModel() {
            const flexion = parseInt(flexionSlider.value);
            const valgus = parseInt(valgusSlider.value);
            
            // Update UI values
            flexionValue.textContent = `${flexion}¬∞`;
            valgusValue.textContent = `${valgus}¬∞`;
            
            // Animate leg bending (flexion)
            const bendAngle = flexion * 0.5; // Scale for visualization
            const bendRad = flexion * Math.PI / 180;
            
            // Rotate thigh (femur) - around knee point (400,300)
            thighGroup.setAttribute('transform', `rotate(${bendAngle}, 400, 300)`);
            
            // Move patella with flexion
            const patellaX = initialPatella.cx + Math.sin(bendRad) * 30;
            const patellaY = initialPatella.cy + (1 - Math.cos(bendRad)) * 40;
            patella.setAttribute('cx', patellaX);
            patella.setAttribute('cy', patellaY);
            
            // Animate valgus (inward collapse)
            const valgusOffset = valgus * 2; // Scale for visualization
            
            // Shift knee inward for valgus
            kneeGroup.setAttribute('transform', `translate(${valgusOffset}, 0)`);
            
            // Stretch ACL with valgus
            const aclX2 = initialACL.x2 + valgusOffset;
            const aclY2 = initialACL.y2 + Math.abs(valgus) * 0.5;
            acl.setAttribute('x2', aclX2);
            acl.setAttribute('y2', aclY2);
            
            // Stretch MCL with valgus
            const mclX2 = initialMCL.x2 + valgusOffset;
            mcl.setAttribute('x2', mclX2);
            
            // Show/hide force vectors for high valgus
            if (valgus > 8) {
                forceVectors.setAttribute('opacity', '1');
            } else {
                forceVectors.setAttribute('opacity', '0');
            }
            
            // Change ACL color based on stress
            const stress = flexion > 30 ? (flexion - 30) / 110 : 0;
            const valgusStress = valgus > 0 ? valgus / 25 : 0;
            const totalStress = Math.min(1, stress + valgusStress);
            
            acl.setAttribute('stroke', `rgb(${255}, ${255 * (1 - totalStress)}, ${255 * (1 - totalStress)})`);
            
            // Calculate biomechanics
            const metrics = calculateInjuryMetrics(flexion, valgus);
            const risk = getRiskInfo(metrics);
            const analysis = getAnalysis(flexion, valgus, metrics);
            const footballRiskText = getFootballRiskText(valgus);
            
            // Update UI
            aclLoad.textContent = metrics.acl;
            riskLevel.textContent = risk.level;
            riskColor.textContent = risk.title;
            riskColor.className = risk.level === "LOW" ? "safe" : 
                                 risk.level === "MODERATE" ? "warning" : "danger";
            
            riskPanel.style.borderColor = risk.borderColor;
            riskPanel.style.background = `rgba(${parseInt(risk.borderColor.slice(1,3), 16)}, ${parseInt(risk.borderColor.slice(3,5), 16)}, ${parseInt(risk.borderColor.slice(5,7), 16)}, 0.1)`;
            
            analysisText.innerHTML = analysis;
            footballRisk.innerHTML = footballRiskText;
            riskTitleText.textContent = risk.title;
        }
        
        // Event listeners
        flexionSlider.addEventListener('input', updateModel);
        valgusSlider.addEventListener('input', updateModel);
        
        // Initialize
        updateModel();
        console.log("2D Human Leg Simulator Loaded!");
    </script>
</body>
</html>